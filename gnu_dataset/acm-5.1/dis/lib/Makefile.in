srcdir = @srcdir@
 VPATH = @srcdir@
  
  OBJS = \
  	disx.o \
	event.o \
	entity.o \
	sitename.o \
	register.o \
	lookup.o \
	simmgr_xdr.o \
	basic.o \
	parse.o \
	io.o \
	free.o \
	sizes.o \
	globe.o\
	datum.o \
	dr.o \
	datum_table.o \
	dis_xdr.o \
	dis_xdr1.o \
	dis_xdr2.o \
	xdr_umem.o \
	xdr_var_array.o

  SRCS = \
  	$(srcdir)/disx.c \
	$(srcdir)/event.c \
	$(srcdir)/entity.c \
	$(srcdir)/sitename.c \
	$(srcdir)/register.c \
	$(srcdir)/lookup.c \
	simmgr_xdr.c \
	$(srcdir)/basic.c \
	$(srcdir)/parse.c \
	$(srcdir)/io.c \
	$(srcdir)/free.c \
	$(srcdir)/sizes.c \
	$(srcdir)/globe.c \
	$(srcdir)/datum.c \
	$(srcdir)/dr.c \
	$(srcdir)/datum_table.c \
	dis_xdr.c \
	$(srcdir)/dis_xdr1.c \
	$(srcdir)/dis_xdr2.c \
	$(srcdir)/xdr_umem.c \
	$(srcdir)/xdr_var_array.c
 DISGEN = ../disgen/disgen
 RPCGEN = rpcgen
#CFLAGS = -I$(srcdir)/.. -I. -I.. -I../dis -DNPSNET_COMPAT @CFLAGS@ @DEFS@
 CFLAGS = -I$(srcdir)/.. -I. -I.. -I../dis @CFLAGS@ @DEFS@
     CC = @CC@
   PERL = perl
 RANLIB = @RANLIB@
     AR = ar
ARFLAGS = cq

all:	libdis.a

libdis.a: ../dis/disp.h simmgr.h $(OBJS)
	rm -f $@
	$(AR) $(ARFLAGS) $@ $(OBJS)
	$(RANLIB) $@

../dis/disp.h dis_xdr.c: dis.x
	$(DISGEN) $(srcdir)/dis.x
	mv dis.h ../dis/disp.h
	mv dis_xdr.c tmp.c
	perl -p -e 's/\#include "dis.h"/#include <disp.h>/' <tmp.c >dis_xdr.c
	rm -f tmp.c

../dis/dis_xdr.h: dis_xdr.c dis_xdr1.c xdrhdr.pl
	cat dis_xdr.c $(srcdir)/dis_xdr1.c | $(PERL) $(srcdir)/xdrhdr.pl $@

simmgr.h: simmgr.x
	rm -f $@
	$(RPCGEN) -h -o $@ $(srcdir)/simmgr.x

simmgr_xdr.c: simmgr.x
	rm -f $@
	$(RPCGEN) -c -o $@ $(srcdir)/simmgr.x
	mv $@ tmp.c
	perl -p -e 's/\#include .*simmgr.*$$/#include "simmgr.h"/' <tmp.c >$@
	rm -f tmp.c

dis_xdr.o: ../dis/dis_xdr.h

datum_table.o: datumtbl.h

datumtbl.h: datumtbl.pl
	$(PERL) $(srcdir)/datumtbl.pl <$(srcdir)/../dis/datum.h >datumtbl.h

clean:
	rm -rf *.o core datumtbl.h libdis.a \
		../dis/disp.h ../dis/dis_xdr.h *.bak \
		dis_xdr.c simmgr.h simmgr_xdr.c

depend: $(SRCS)
	makedepend -- $(CFLAGS) -- $(SRCS)

distclean: clean
	rm -f Makefile

tags TAGS check test:

# DO NOT DELETE THIS LINE -- make depend depends on it.
